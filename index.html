<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />


  <style>
    body {
      background-color: black;
      color:white
    }

    h3 {
      color: #b5d449;
      text-align: left;

    }

        h4 {
            color: #b5d449;
            text-align: left;
        }

    .logo {
      background: #212529;
      margin: -8px;
      text-align: center;
    }

    .logo img {
      margin: 5px;
    }

    p.dotted {border-style: dotted;}
    p.dashed {border-style: dashed;}
    p.solid {border-style: solid;}
    p.double {border-style: double;background-color: #b5d449; border-bottom: 6px double white}
    p.groove {border-style: groove;}
    p.ridge {border-style: ridge;}
    p.inset {border-style: inset;}
    p.outset {border-style: outset;}
    p.none {border-style: none;}
    p.hidden {border-style: hidden;}
    p.mix {border-style: dotted dashed solid double;}

    #ex1 .filter-content {
      display: none;
    }

    #ex1 {
      color: #000;
    }
  </style>
</head>


<body>
    <div class="logo">
        <img src="cti_logo_details.png" alt="Canterbury Techinical Institute">
    </div>

    <a href="#ex2" rel="modal:open">Import JSON</a>

    <p class="double" id="topic2"></p>

    <div id="ex1" class="modal">
      <h1>Filtered Units</h1>
      <ul class="filtered_units"></ul>
      <button type="button" class="export_json">Export JSON</button>
    </div>

    <div id="ex2" class="modal">
      <h1>Import JSON</h1>
      <textarea type="text" class="input_json" rows="5"></textarea>
      <button type="button" class="import_json">Import JSON</button>
    </div>

    <ul class=solid id="topic3"></ul>

    <p id="topic4"></p>

    <button class="open_modal">Submit filtered Units</button>


    <script>

        var myAllCourseTopics =
            `{
              "code": "ICT60115",
              "name": "Advanced Diploma of Information Technology",
              "units": [
                  {
                      "EPC": {
                          "1": {
                              "name": "Manage adherence to copyright regulations",
                              "pc": {
                                  "1.1": {
                                      "text": "Review current Australian copyright law, and in particular its relationship to information and communications technology (ICT)"
                                  },
                                  "1.2": {
                                      "text": "Ensure that team members are aware of Australian copyright law and how it affects their work"
                                  },
                                  "1.3": {
                                      "text": "Institute measures to ensure that copyright is not breached"
                                  },
                                  "1.4": {
                                      "text": "Institute regular reviews to ensure organisational copyright requirements are up to date and team members are adhering to these requirements"
                                  },
                                  "1.5": {
                                      "text": "Distribute updated versions if required"
                                  }
                              }
                          },
                          "2": {
                              "name": "Manage ethical behaviour",
                              "pc": {
                                  "2.1": {
                                      "text": "Review appropriate code of ethics, both organisational and ICT specific"
                                  },
                                  "2.2": {
                                      "text": "Acquaint team members with ethical requirements"
                                  },
                                  "2.3": {
                                      "text": "Institute regular reviews of team members ethical work practices and feedback to ensure correct application of the code"
                                  },
                                  "2.4": {
                                      "text": "Ensure that stakeholders are aware of ethics code, and adjust appropriately following stakeholder feedback"
                                  },
                                  "2.5": {
                                      "text": "Institute regular reviews of stakeholder understanding and application of code of ethics"
                                  },
                                  "2.6": {
                                      "text": "Establish a review and grievance procedure to enable confidential reporting of ethical issues"
                                  },
                                  "2.7": {
                                      "text": "Institute regular reviews of code of ethics, updating and distributing as required"
                                  }
                              }
                          },
                          "3": {
                              "name": "Manage privacy",
                              "pc": {
                                  "3.1": {
                                      "text": "Institute a regular review of the relevance of legislation and standards to organisational outcomes, the organisation's privacy policy and procedures, and the work practices of team members with regard to these requirements"
                                  },
                                  "3.2": {
                                      "text": "Determine and ensure the integrity, confidentiality, security and availability of information as required by the organisational policy"
                                  },
                                  "3.3": {
                                      "text": "Ensure continued confidentiality and proprietary rights of stakeholders' interests"
                                  },
                                  "3.4": {
                                      "text": "Contribute to the creation or updating of the organisation's privacy policy and procedures to align with privacy legislation"
                                  },
                                  "3.5": {
                                      "text": "Distribute new or revised policy and procedures to stakeholders"
                                  },
                                  "3.6": {
                                      "text": "Implement new work procedures and collect feedback from stakeholders"
                                  }
                              }
                          }
                      },
                      "code": "ICTICT610",
                      "name": "Manage Copyright, Ethics and Privacy in an IT Environment"
                  }
              ]
          }`;

        function addFilter() {
          $('.btnFilter').on("click", function () {
              var text = $(this).siblings('input.filter').val().toLowerCase();
              if (text) {
                  $(this).parent().siblings("li.sub-unit").each(function (idx, element) {

                      var title = $(element).find('h4');
                      if (!title.text().toLowerCase().includes(text)) {
                          $(element).hide();
                      }
                  });
              } else {
                  $("li.sub-unit").each(function (idx, element) {
                      $(element).show();
                  });
              }
          })
        }

        function create_html(object) {
          var myObj2 = object;

          document.getElementById("topic2").innerHTML = myObj2.name;
          $("#topic2").attr('data-course-code', myObj2.code);

          $('#topic3').html("");

          for (var myObj3 in myObj2.units) {

              $('#topic3').append('<li data-unit-id="' + myObj2.units[myObj3].code + '" class="unit"><h3 class="title"> ' + myObj2.units[myObj3].name + '</h3><ul id="unit' + myObj2.units[myObj3].code +'-list" data-subunit-id="' + myObj2.units[myObj3].code + '"><div class="filter-content"><h3 class="filter-title">Filter by Topic</h3><input type="text" class="filter"><button class="btnFilter">Filter</button></div></ul> </li>');
              for (var myObj4 in myObj2.units[myObj3].EPC) {
                  $('#unit' + myObj2.units[myObj3].code + 'list').
                      append('<li id="unit-' + myObj2.units[myObj3].code + '-' + myObj4 + '" class="sub-unit">' + myObj4 + ' ' + myObj2.units[myObj3].EPC[myObj4].name + '</li>');

                  $('#unit' + myObj2.units[myObj3].code + '-list').
                      append('<li class="sub-unit" id="unit-' + myObj2.units[myObj3].code + '-' + myObj4 + '-pc"><h4 data-unit-id="' + myObj4 + '">' + myObj2.units[myObj3].EPC[myObj4].name + '</h4><ul id="unit-' + myObj2.units[myObj3].code + '-' + myObj4 + '-pc-list"></ul></li>');
                  for (var myObj5 in myObj2.units[myObj3].EPC[myObj4].pc) {
                      $('#unit-' + myObj2.units[myObj3].code + '-' + myObj4 + '-pc-list').
                          append('<li class="lesson" data-class-id="' + myObj5 + '"> ' +  myObj2.units[myObj3].EPC[myObj4].pc[myObj5].text + '</li>');
                  }
              }
          }

          addFilter();
        }

        create_html(JSON.parse(myAllCourseTopics));

        $('.open_modal').on('click', function() {
          $('ul.filtered_units').html("");

          $('li.sub-unit:visible').each(function(idx, element) {
            var content = $(element).parents('li.unit').get(0).outerHTML;
            if (!$('ul.filtered_units').html().includes(content)) {
              $('ul.filtered_units').append(content);
            }
          });
          $('#ex1').modal({
            fadeDuration: 250,
            fadeDelay: 0.80
          });
        });

        $('.export_json').on('click', function() {
          var newJson = {};
          newJson.name = $('#topic2').text();
          newJson.code = $('#topic2').data('course-code');
          newJson.units = [];

          $('ul.filtered_units > li').each(function() {
            var unit = {};
            unit.name = $(this).find('h3').text();
            unit.code = $(this).data('unit-id');
            unit.EPC = {};

            $(this).find('ul li.sub-unit:visible').each(function(){
              var h4Element = $(this).find('h4');
              var subUnitId = h4Element.data('unit-id')
              unit.EPC[subUnitId] = {};
              unit.EPC[subUnitId].name = h4Element.text();
              unit.EPC[subUnitId].pc = {};

              $(this).find('ul li').each(function(idx, element) {
                var lessonName = $(this).text(),
                    class_id = $(this).data('class-id');

                unit.EPC[subUnitId].pc[class_id] = {};
                unit.EPC[subUnitId].pc[class_id].text =lessonName;
              });
            });

            newJson.units.push(unit);
          });
          $.modal.close();
          alert(JSON.stringify(newJson));
        });

        $('.import_json').on('click', function() {
          var new_json= JSON.parse($('textarea.input_json').val());
          create_html(new_json);
          $('.input_json').val("");
          $.modal.close();
        });

    </script>
</body>
</html>
